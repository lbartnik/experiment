<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="lib/vis-4.21.0/vis.min.js"></script>
<script src="lib/jquery-3.2.1/jquery.js"></script>
<link href="lib/jquery-ui-1.12.1/jquery-ui.css" rel="stylesheet" />
<link href="lib/jquery-ui-1.12.1/jquery-ui.structure.css" rel="stylesheet" />
<link href="lib/jquery-ui-1.12.1/jquery-ui.theme.css" rel="stylesheet" />
<script src="lib/jquery-ui-1.12.1/jquery-ui.js"></script>
<script src="lib/d3-4.11.0/d3.min.js"></script>

</head>
<body style="background-color:white;">
<script id="graph" type="application/json">
    {"nodes":[{"id":"3739589b87724e2e69321de38cd0f6fe7e6c9429","short_id":"3739589b","rclass":"commit"},{"id":"7f558abcc2a7046d0a28352fdb81b7b9695f634b","rclass":"data.frame","name":"iris2"},{"id":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8","rclass":"lm","name":"x"},{"id":"96ea722bf140a98c6854f9532985372a768df257","short_id":"96ea722b","rclass":"commit"},{"id":"d99314eda4b97a47e6fdd15ef6125d8160a922dc","rclass":"data.frame","name":"iris2"},{"id":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8","rclass":"lm","name":"x"},{"id":"db499331c8ee97abfbb56fb5a165d95c474529ba","short_id":"db499331","rclass":"commit"},{"id":"7f558abcc2a7046d0a28352fdb81b7b9695f634b","rclass":"data.frame","name":"iris2"},{"id":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8","rclass":"lm","name":"x"},{"id":"5927d42255bd460f632df0a1ed9dc3aa570f3cd2","rclass":"lm","name":"y"},{"id":"f8eb7285673f22777d14b21c8f686167f1a4a527","short_id":"f8eb7285","rclass":"commit"},{"id":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8","rclass":"lm","name":"x"}],"links":[{"source":"3739589b87724e2e69321de38cd0f6fe7e6c9429","target":"db499331c8ee97abfbb56fb5a165d95c474529ba"},{"source":"3739589b87724e2e69321de38cd0f6fe7e6c9429","target":"7f558abcc2a7046d0a28352fdb81b7b9695f634b"},{"source":"3739589b87724e2e69321de38cd0f6fe7e6c9429","target":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8"},{"source":"96ea722bf140a98c6854f9532985372a768df257","target":"3739589b87724e2e69321de38cd0f6fe7e6c9429"},{"source":"96ea722bf140a98c6854f9532985372a768df257","target":"d99314eda4b97a47e6fdd15ef6125d8160a922dc"},{"source":"96ea722bf140a98c6854f9532985372a768df257","target":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8"},{"source":"db499331c8ee97abfbb56fb5a165d95c474529ba","target":"7f558abcc2a7046d0a28352fdb81b7b9695f634b"},{"source":"db499331c8ee97abfbb56fb5a165d95c474529ba","target":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8"},{"source":"db499331c8ee97abfbb56fb5a165d95c474529ba","target":"5927d42255bd460f632df0a1ed9dc3aa570f3cd2"},{"source":"f8eb7285673f22777d14b21c8f686167f1a4a527","target":"96ea722bf140a98c6854f9532985372a768df257"},{"source":"f8eb7285673f22777d14b21c8f686167f1a4a527","target":"55e31741b2a7f0eb7e1ada91b3e587df096d6ed8"}]}
</script>


<script type="application/javascript">

function mapNodes (nodes) {
    nodesMap = d3.map();
    nodes.forEach(function (n) {
      nodesMap.set(n.id, n);
    });
    return nodesMap;
}



var data = JSON.parse($("#graph").html());

var width = 500, height = 500;

var vis = d3.select('body').append("svg")
      .attr("width", width)
      .attr("height", height);

var linksG = vis.append("g").attr("id", "links");
var nodesG = vis.append("g").attr("id", "nodes");

data.nodes.forEach(function(n) {
    n.x = Math.floor(Math.random()*width);
    n.y = Math.floor(Math.random()*height);
});

var nodesMap  = mapNodes(data.nodes);

data.links.forEach(function (l) {
    l.source = nodesMap.get(l.source);
    l.target = nodesMap.get(l.target);
});


var node = nodesG.selectAll("circle.node")
      .data(data.nodes, function (d) { return d.id; });

node.enter().append("circle")
      .attr("class", "node")
      .attr("cx", function (d) { return d.x; })
      .attr("cy", function (d) { return d.y; })
      .attr("r", 5);

node.exit().remove();

var link = linksG.selectAll("line.link")
      .data(data.links, function (d) { d.source.id + "_" + d.target.id; });

link.enter().append("line")
      .attr("class", "link")
      .attr("stroke", "#ddd")
      .attr("stroke-opacity", 0.8)
      .attr("x1", function (d) { d.source.x; })
      .attr("y1", function (d) { d.source.y; })
      .attr("x2", function (d) { d.target.x; })
      .attr("y2", function (d) { d.target.y; });

link.exit().remove();


function forceTick (e) {
    d3.selectAll("circle.node")
      .attr("cx", function (d) { return d.x; })
      .attr("cy", function (d) { return d.y; });

    d3.selectAll("line.link")
      .attr("x1", function (d) { return d.source.x; })
      .attr("y1", function (d) { return d.source.y; })
      .attr("x2", function (d) { return d.target.x; })
      .attr("y2", function (d) { return d.target.y; });
}

var simulation = d3.forceSimulation(data.nodes)
    .on("tick", forceTick)
    .force("charge", d3.forceManyBody())
    .force("link", d3.forceLink(data.links));

//        .linkDistance(50);

nodesG.selectAll("circle.node")
    .style("fill", function (d) {
        if (d.rclass == "commit") return "red";
    })
    .on("mouseover", function (d) {
        console.log(d);
    });

</script>


</body>
</html>
